@model IEnumerable<OnlineBanking.DAL.Roles>

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}

<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Role Management </h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Role Management</li>
                    </ol>
                </div>
            </div>
        </div><!-- /.container-fluid -->
    </section>

    <!-- Main content -->
    <section class="content">
        <div class="col-md-12">
            <button class="btn btn-primary mb-3" id="btn-add">Create new Role</button>
            <div class="card card-success">
                <div class="card-header">
                    <h3 class="card-title">Role Management</h3>
                </div>
                <div class="card-body">
                    <div class="form-inline">
                        <label>Search : </label>
                        <input type="text" class="form-control form-control-sm" placeholder="Name..." name="key" id="key">
                    </div>
                    <table class="table table-hover" id="datatables">
                        <thead>
                            <tr>
                                <th>RoleId</th>
                                <th>Name</th>
                                <th>Status </th>
                                <th>Action </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="tbl_role"></tbody>

                    </table>
                </div>
                <div class="card-footer d-flex justify-content-center">
                    <ul class="pagination" id="pagination">
                    </ul>
                </div>
                <!-- /.card-body -->
            </div>
        </div>
        <!-- Default box -->
        <!-- /.card -->

    </section>
    <!-- /.content -->

    <div class="modal fade" id="modifyModal" role="dialog">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Create new Role</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
                <div class="modal-body">
                    <form action="/" id="form" method="post">
                        <input type="hidden" name="Id" id="Id" value="" />
                        <input type="hidden" name="type" id="type" value="CREATE" />
                        <div class="form-group">
                            <label for="Name">Name</label>
                            <input type="text" class="form-control" id="Name" name="Name" value="" placeholder="Name..." />
                        </div>
                        <div class="form-group">
                            <label for="Status">Status</label>
                            <select id="Status" name="Status" class="form-control">
                                <option value="1">Actived</option>
                                <option value="0">Deleted</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success toastrDefaultSuccess" id="btnSave">Save</button>
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Cancel</button>
                </div>
            </div>

        </div>
    </div>
</div>

@section scripts{
    <script>
        var roleManager = {
            load: function (page = 1, key = null) {
                $.ajax({
                    type: "GET",
                    url: "/Admin/Roles/GetData",
                    data: { page: page, key: key },
                    success: function (res) {
                        console.log(res)
                        let _html = "";
                        for (let item of res.data) {
                            _html += `<tr>
                                                    <td>${(item.RoleId) == null ? "" : item.RoleId}</td>
                                                    <td>${(item.Name) == null ? "" : item.Name}</td>
                                                    <td>${(item.Status) == null ? "" : item.Status}</td>
                                                    <td class="btn-group"><button data-toggle="modal" data-target="#modifyModal" data-id="${item.RoleId}" class='btn btn-warning btn-edit'>Edit</button><button data-id="${item.RoleId}" class='btn btn-danger btn-delete'>Detele</button></td>
                                                     </tr>`
                        }
                        $('#tbl_role').html(_html);
                        var pages = '';
                        for (var i = 1; i <= res.totalPages; i++) {
                            if (i == res.currentPage) {
                                pages += `<li class=" page-item active"><a href="javascript:void(0)" class="item-page page-link">${i}</a></li>`;
                            } else {
                                pages += `<li class="page-item"><a href="javascript:void(0)" class="item-page page-link">${i}</a></li>`;
                            }
                        }
                        $(".pagination").html(pages);
                    }
                });
            },
            post: function (role) {
                $.ajax({
                    type: "POST",
                    url: "/Admin/Roles/PostData",
                    data: role,
                    success: function (res) {
                        if (res.statusCode == 200) {
                            $("#modifyModal").modal("hide");
                            roleManager.load();
                            toastr.success('Created Successfully');
                        }
                    }

                })
            },
            put: function (role) {
                $.ajax({
                    type: "POST",
                    url: "/Admin/Roles/PutData",
                    data: role,
                    success: function (res) {
                        $("#modifyModal").modal("hide");
                        toastr.success('Updated Successfully');
                        roleManager.load();
                    }
                })
            },
            get: function (id) {
                $.ajax({
                    type: "GET",
                    url: "/Admin/Roles/FindId",
                    data: { id: id },
                    success: function (res) {
                        $("#Name").val(res.Name);
                        $("#modifyModal").modal("show");
                    }
                })
            },
            delete: function (id) {
                $.ajax({
                    type: "GET",
                    url: `/Admin/Roles/Delete/${id}`,
                    success: function (res) {
                        roleManager.load();
                        toastr.success('Deleted Successfully');
                    }
                })
            }
        }

        $(function () {
            roleManager.load();

            $("#btn-add").click(function () {
                $("#modifyModal").modal("show");
            });

            $("#btnSave").click(function () {
                var role = {
                    Name: $("#Name").val(),
                    Status: $("#Status").val(),
                }
                if ($("#type").val() == "EDIT") {
                    role.RoleId = $("#Id").val(),
                        roleManager.put(role);
                } else {
                    roleManager.post(role);
                }
            });

            $(document).on("click", ".item-page", function () {
                let page = $(this).text();
                let key = $("#key").val();
                roleManager.load(page, key);
            });

            $("#key").keyup(function () {
                let key = $("#key").val();
                roleManager.load(1, key);
            });

            $(document).on("click", ".btn-edit", function () {
                $(".modal-title").html("Update Currency");
                $("#type").val("EDIT");
                let roleId = $(this).data("id");
                $("#Id").val(roleId);
                roleManager.get(roleId);
            });

            $(document).on("click", ".btn-delete", function () {
                let roleId = $(this).data("id");
                roleManager.delete(roleId);
            })

            $('#modifyModal').on('hidden.bs.modal', function (e) {
                $("#form").trigger("reset");
            })
        })

    </script>
}
